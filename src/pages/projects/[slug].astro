---
import Base from '../../layouts/SectionLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.data.id },
    props: { project },
  }));
}

const { project } = Astro.props;
const { data } = project;
const { Content } = await project.render();
---
<Base title={`${data.title} ‚Äî Project`}>
  <article class="project-page">
    <h1>{data.title} <span class="muted">({data.year})</span></h1>

    <div class="abstract">
      <Content />
    </div>

    {/* Capabilities / Metrics */}
    {data.metrics && (
      <div class="metrics-section">
        <h2>Metrics</h2>
        <ul>
          {data.metrics.loc && <li><strong>LOC:</strong> {data.metrics.loc.toLocaleString()}</li>}
          {data.metrics.gpu_hours && <li><strong>GPU Hours:</strong> {data.metrics.gpu_hours}h</li>}
          {data.metrics.boot_sec && <li><strong>Boot Time:</strong> {data.metrics.boot_sec}s</li>}
          {data.metrics.dataset_size && <li><strong>Dataset:</strong> {data.metrics.dataset_size}</li>}
        </ul>
      </div>
    )}

    {/* Images gallery */}
    {data.images && data.images.length > 0 && (
      <div class="images-section">
        <h2>Images</h2>
        <div class="images-grid">
          {data.images.map((img) => (
            <a href={img} class="lightbox thumb">
              <img src={img} alt={data.title} loading="lazy" />
            </a>
          ))}
        </div>
      </div>
    )}

    {/* Related materials */}
    <div class="related-section">
      <h2>Related Material</h2>
      <ul>
        {data.artifacts?.readme && (
          <li><a href={data.artifacts.readme}>README</a></li>
        )}
        {data.artifacts?.postmortem && (
          <li><a href={data.artifacts.postmortem}>Postmortem / Notes</a></li>
        )}
        <li><a href="/catalog">‚Üê Back to Catalog</a></li>
      </ul>
    </div>

    {/* Status badge */}
    <div class="badges">
      {data.domain.map(tag => <span class="tag">{tag}</span>)}
      <span class={`badge ${data.status}`}>{data.status}</span>
    </div>
  </article>
</Base>

<style>
  .project-page {
    max-width: 880px;
  }

  .diagram-section,
  .metrics-section,
  .images-section,
  .related-section {
    margin-top: 2em;
  }

  .diagram-section {
    background: #f9f9f9;
    padding: 16px;
    border: 1px solid #ddd;
  }

  .diagram-section img {
    width: 100%;
    height: auto;
    border: 1px solid #ccc;
    cursor: zoom-in;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    background: white;
  }

  .diagram-section a {
    display: block;
    position: relative;
  }

  .diagram-section a::after {
    content: "üîç Click to zoom";
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    font-size: 11px;
    border-radius: 2px;
    font-family: 'Courier New', Courier, monospace;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .diagram-section a:hover::after {
    opacity: 1;
  }

  .images-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
    margin-top: 1em;
  }

  .images-grid img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border: 1px solid #ccc;
    cursor: pointer;
  }

  .metrics-section ul {
    list-style: none;
    padding-left: 0;
  }

  .metrics-section li {
    margin-bottom: 0.5em;
  }

  .muted {
    color: #666;
  }

  .badges {
    margin-top: 2em;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .tag {
    font-family: 'Courier New', Courier, monospace;
    font-size: 11px;
    color: #444;
    padding: 2px 6px;
    border: 1px solid #ccc;
  }

  .badge {
    font-family: 'Courier New', Courier, monospace;
    font-size: 11px;
    padding: 2px 6px;
    border: 1px solid #ccc;
  }

  .badge.active {
    background: #e8f5e9;
    border-color: #4caf50;
  }

  .badge.archived {
    background: #fafafa;
    border-color: #999;
    color: #666;
  }

  .badge.paused {
    background: #fff8e1;
    border-color: #ffc107;
  }
</style>
